{% extends 'admin/master.html' %}

{% block body %}
<div class="container-fluid">
    <h1 class="mb-4">
        <i class="fa fa-search"></i> Search Results: "{{ query }}"
    </h1>
    
    <div class="row mb-3">
        <div class="col-md-12">
            <a href="{{ url_for('cjimport.index') }}" class="btn btn-secondary">
                <i class="fa fa-arrow-left"></i> New Search
            </a>
        </div>
    </div>
    
    {% if results and results.products %}
    <div class="row">
        {% for product in results.products %}
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <img 
                    src="{{ product.image_url or 'https://via.placeholder.com/300x300?text=No+Image' }}" 
                    class="card-img-top" 
                    alt="{{ product.name }}"
                    style="height: 250px; object-fit: cover;"
                >
                <div class="card-body">
                    <h5 class="card-title">{{ product.name[:60] }}{% if product.name|length > 60 %}...{% endif %}</h5>
                    <p class="card-text">
                        <strong>CJ ID:</strong> {{ product.cj_product_id }}<br>
                        <strong>Price:</strong> ${{ "%.2f"|format(product.selling_price) }}
                        {% if product.original_price > product.selling_price %}
                        <del class="text-muted">${{ "%.2f"|format(product.original_price) }}</del>
                        {% endif %}
                    </p>
                    
                    <form method="POST" action="{{ url_for('cjimport.import_product', cj_product_id=product.cj_product_id) }}">
                        <div class="form-group">
                            <label for="custom_price_{{ product.cj_product_id }}">
                                <strong>Prix de vente ($)</strong>
                            </label>
                            <input 
                                type="number" 
                                step="0.01" 
                                min="0" 
                                class="form-control form-control-sm" 
                                id="custom_price_{{ product.cj_product_id }}" 
                                name="custom_price" 
                                value="{{ product.selling_price }}"
                                required
                            >
                            <small class="form-text text-muted">Prix CJ: ${{ "%.2f"|format(product.selling_price) }}</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="commission_rate_{{ product.cj_product_id }}">
                                Commission Rate (%)
                            </label>
                            <input 
                                type="number" 
                                step="0.1" 
                                min="0" 
                                max="100" 
                                class="form-control form-control-sm" 
                                id="commission_rate_{{ product.cj_product_id }}" 
                                name="commission_rate" 
                                value="10"
                                required
                            >
                        </div>
                        
                        <div class="form-group">
                            <label for="category_id_{{ product.cj_product_id }}">
                                <strong style="color: red;">* Catégorie (Obligatoire)</strong>
                            </label>
                            <select 
                                class="form-control form-control-sm" 
                                id="category_id_{{ product.cj_product_id }}" 
                                name="category_id"
                                required
                            >
                                <option value="">-- Sélectionner une catégorie --</option>
                                {% for category in categories %}
                                <option value="{{ category.id }}">{{ category.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <button type="submit" class="btn btn-success btn-block">
                            <i class="fa fa-download"></i> Importer le Produit
                        </button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <div class="row mt-4">
        <div class="col-md-12 text-center">
            <p class="text-muted">
                Showing {{ results.products|length }} of {{ results.total }} products
            </p>
        </div>
    </div>
    {% else %}
    <div class="row">
        <div class="col-md-12">
            <div class="alert alert-warning">
                <h5><i class="fa fa-exclamation-triangle"></i> No Results Found</h5>
                <p>No products found for "{{ query }}". Try a different search term.</p>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
